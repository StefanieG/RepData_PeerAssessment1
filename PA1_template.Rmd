---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

### Introduction

This is the first project of the **Reproducible Research** course in the Coursera Data Science Specialization track. The assignment makes use of data from personal activity monitoring devices. 

### Data

The data consists of two months of data from an anonymous individual collected during the months of October and November, 2012 and include the number of steps taken in 5 minute invervals each day. 

The data for this assignment were downloaded from the course website:

- **Dataset:** [Activity monitoring data](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip) [52K]

The variables included in the dataset are:

- **steps:** Number of steps taking in a 5-minute interval (missing values are coded as `NA`)
- **date:** The date on which the measurement was taken in YYYY-MM-DD format
- **interval:** Identifier for the 5-minute interval in which measurement was taken

The dataset is stored in a comma-separated-value (CSV) file and there are a total of 17,568 observations in this dataset.

## Assignment

The assignment answers the following questions:

## Loading and preprocessing the data

Download, unzip load data into a data frame `activity_data`.

```{r}
if(!file.exists("getdata-projectfiles-UCI HAR Dataset.zip")) {
        temp <- tempfile()
        download.file("http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip",temp)
        unzip(temp)
        unlink(temp)
}

activity_data <- read.csv("activity.csv")

head(activity_data)
```

## What is mean total number of steps taken per day?

First the steps by day need to be summed up: 
```{r}
aggregate_steps <- aggregate(steps ~ date, activity_data, sum)
head(aggregate_steps)
```

The histogram shows that a daily step count between 10,000 and 15,000 steps was quite frequent:
```{r}
hist(aggregate_steps$steps, main = "Total steps by day", xlab = "Number of steps", col = "cadetblue")
```

```{r}
summary(aggregate_steps)
```

The **mean** total number of steps is `10,766`, the **median** total number of steps is `10,765`. 

## What is the average daily activity pattern?

Steps need to be summed up per day by interval:
```{r}
aggregate_interval <- aggregate(steps ~ interval, activity_data, sum)
head(aggregate_interval)
```

The series plot suggests that the maximum value is around the 800th interval:
```{r}
library(ggplot2)
ggplot(aggregate_interval, aes(x=interval, y=steps)) + 
        geom_line(color = "cadetblue") +
        xlab("Intervals") +
        ylab("Number of steps") +
        ggtitle("Average number of steps per day by interval") 
```     

```{r}
aggregate_interval[which.max(aggregate_interval$steps),1] 
```

The 5 minute interval, on average across all the days in the dataset, that contains the maximum number of steps taken is `835`.

## Imputing missing values

There are a number of days/intervals where there are missing values (coded as `NA`). The presence of missing days may introduce bias into some calculations or summaries of the data.

This calculates the total number of mising values in the dataset:
```{r}
for (Var in names(activity_data)) {
        missing <- sum(is.na(activity_data[,Var]))
        if (missing > 0) {
                print(c(Var,missing))
        }
} 
```

The total number of missing values in the dataset is `2304`.

Imputing missing values with mean for 5 minute interval:
```{r}
#Remove NAs and prepare the new dataframe:
newData <- data.frame(activity_data$steps)
newData[is.na(newData),] <- ceiling(tapply(X=activity_data$steps,INDEX=activity_data$interval,FUN=mean,na.rm=TRUE))
activity_clean <- cbind(newData, activity_data[,2:3])
colnames(activity_clean) <- c("steps", "date", "Interval")

#Calculate the new number of steps per day. 
new_steps_aggregate <- aggregate(steps ~ date, activity_clean, sum)
head(new_steps_aggregate)
```

A new histogram based on the above new dataset looks as follows:
```{r}
hist(new_steps_aggregate$steps, main = "Total steps by day", xlab = "Number of steps", col = "lightsteelblue1")
```

```{r}
summary(new_steps_aggregate)
```

The new **mean** total number of steps is `10,785`, the **median** total number of steps is `10,909`. 

It seems that adding the missing values to the original data has caused both the mean and median values to increase.

- **mean:** 10766 to 10785
- **median:** 10765 to 10909

## Are there differences in activity patterns between weekdays and weekends?

This creates a new factor variable in the dataset that with two levels - "weekday" and "weekend": 
```{r}
#Assign the new factor variable:
dateDayType <- data.frame(sapply(X = activity_clean$date, FUN = function(day) {
    if (weekdays(as.Date(day)) %in% c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday")) {
        day <- "weekday"
    } else {
        day <- "weekend"
    }
}))

activity_clean_day <- cbind(activity_clean, dateDayType)

colnames(activity_clean_day) <- c("steps", "date", "interval", "day")

#Calculate the average number of steps per 5 minute interval:
aggregate_days <- aggregate(steps ~ day + interval, activity_clean_day, mean)

head(aggregate_days)
```

The panel plot shows the differences between weekdays and weekends:
library("lattice")
```{r}
library(lattice)
xyplot(
    type="l",
    data=aggregate_days,
    steps ~ interval | day,
    xlab="Interval",
    ylab="Number of steps",
    layout=c(1,2)
)
```